!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("hyperapp")):"function"==typeof define&&define.amd?define(["exports","hyperapp"],n):n(t.HoaRouter={},t.hyperapp)}(this,function(u,n){"use strict";function f(n){u.pathOf||(u.pathOf=function(t){return t[n]})}function c(t){return t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")}function s(t,n,e,r){return{isExact:t,path:n,url:e,params:r}}function h(t){for(var n=t.length;"/"===t[--n];);return t.slice(0,n+1)}function l(n){try{return decodeURIComponent(n)}catch(t){return n}}function p(e){return{state:{pathname:e.location.pathname,previous:null},actions:{push:function(t){e.push(t)},replace:function(t){e.replace(t)},onChange:function(t){var e=t.location;return function(t){var n=t.pathname;return{pathname:e.pathname,previous:n}}}},subscribe:function(n){return e.listen(function(t){u.pathOf(n).onChange({location:t})})}}}u.pathOf=void 0;var e="_hoa_router_session",r=window.sessionStorage,o=function(t){return JSON.parse(r.getItem(t))},a=function(t,n){return r.setItem(t,JSON.stringify(n))};function v(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e;return{state:{stack:o(i)||[t.location]},actions:{onSessionChange:function(t){var r=t.location,o=t.action;return function(t){var n=t.stack,e=void 0;switch(o){case"PUSH":e=n.concat(r);case"REPLACE":e=n.slice(0,-1).concat(r);case"POP":default:e=n}return a(i,e),{stack:e}}}},subscribe:function(e){return t.listen(function(t,n){u.pathOf(e).onSessionChange({location:t,action:n})})}}}!function(){function s(t){this.value=t}function t(o){var i,a;function u(t,n){try{var e=o[t](n),r=e.value;r instanceof s?Promise.resolve(r.value).then(function(t){u("next",t)},function(t){u("throw",t)}):c(e.done?"return":"normal",e.value)}catch(t){c("throw",t)}}function c(t,n){switch(t){case"return":i.resolve({value:n,done:!0});break;case"throw":i.reject(n);break;default:i.resolve({value:n,done:!1})}(i=i.next)?u(i.key,i.arg):a=null}this._invoke=function(r,o){return new Promise(function(t,n){var e={key:r,arg:o,resolve:t,reject:n,next:null};a?a=a.next=e:(i=a=e,u(r,o))})},"function"!=typeof o.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}();var y=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t};u.Link=function(a,t){return function(e,r){var o=a.to,i=a.onclick;return delete a.to,delete a.location,a.href=o,a.onclick=function(t){var n;i&&i(t),t.defaultPrevented||0!==t.button||t.altKey||t.metaKey||t.ctrlKey||t.shiftKey||"_blank"===a.target||(n=t.currentTarget,c(window.location)!==c(n))||(t.preventDefault(),o!==u.pathOf(e).pathname&&u.pathOf(r).push(o))},n.h("a",a,t)}},u.init=f,u.Redirect=function(e){return function(t,n){u.pathOf(n).replace(e.to)}},u.Route=function(r){return function(t,n){t=u.pathOf(t);var e=function(t,n,e){if(t===n||!t)return s(t===n,t,n);var r=e&&e.exact,o=h(t).split("/"),i=h(n).split("/");if(!(o.length>i.length||r&&o.length<i.length)){var a=0,u={},c=o.length;for(n="";a<c;a++){if(":"===o[a][0])u[o[a].slice(1)]=i[a]=l(i[a]);else if(o[a]!==i[a])return;n+=i[a]+"/"}return s(!1,t,n.slice(0,-1),u)}}(r.path,t.pathname,{exact:!r.parent});return e&&r.render({match:e,state:t})}},u.routerFactory=p,u.sessionFactory=v,u.Switch=function(t,o){return function(t,n){for(var e,r=0;!(e=o[r]&&o[r](t,n))&&r<o.length;)r++;return e}},u.withRouter=function(a,t){var n=t.name,u=void 0===n?"router":n,c=t.history;return function(t,n,e,r){f(u);var o=p(c);t[u]=o.state,n[u]=o.actions;var i=a(t,n,e,r);return o.subscribe(i),i}},u.withSession=function(u,t){var n=t.name,c=void 0===n?"router":n,s=t.history;return function(t,n,e,r){f(c);var o=p(s),i=v(s);t[c]=y({},o.state,i.state),n[c]=y({},o.actions,i.actions);var a=u(t,n,e,r);return o.subscribe(a),i.subscribe(a),a}},Object.defineProperty(u,"__esModule",{value:!0})});