!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("hyperapp")):"function"==typeof define&&define.amd?define(["exports","hyperapp"],n):n(t.HoaRouter={},t.hyperapp)}(this,function(i,n){"use strict";function p(n){i.pathOf||(i.pathOf=function(t){return t[n]})}function c(t){return t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")}function f(t,n,e,r){return{isExact:t,path:n,url:e,params:r}}function s(t){for(var n=t.length;"/"===t[--n];);return t.slice(0,n+1)}function l(n){try{return decodeURIComponent(n)}catch(t){return n}}i.pathOf=void 0;!function(){function f(t){this.value=t}function t(o){var u,a;function i(t,n){try{var e=o[t](n),r=e.value;r instanceof f?Promise.resolve(r.value).then(function(t){i("next",t)},function(t){i("throw",t)}):c(e.done?"return":"normal",e.value)}catch(t){c("throw",t)}}function c(t,n){switch(t){case"return":u.resolve({value:n,done:!0});break;case"throw":u.reject(n);break;default:u.resolve({value:n,done:!1})}(u=u.next)?i(u.key,u.arg):a=null}this._invoke=function(r,o){return new Promise(function(t,n){var e={key:r,arg:o,resolve:t,reject:n,next:null};a?a=a.next=e:(u=a=e,i(r,o))})},"function"!=typeof o.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}();var h=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t};i.Link=function(a,t){return function(e,r){var o=a.to,u=a.onclick;return delete a.to,delete a.location,a.href=o,a.onclick=function(t){var n;u&&u(t),t.defaultPrevented||0!==t.button||t.altKey||t.metaKey||t.ctrlKey||t.shiftKey||"_blank"===a.target||(n=t.currentTarget,c(window.location)!==c(n))||(t.preventDefault(),o!==i.pathOf(e).pathname&&i.pathOf(r).push(o))},n.h("a",a,t)}},i.init=p,i.Redirect=function(e){return function(t,n){i.pathOf(n).replace(e.to)}},i.Route=function(r){return function(t,n){t=i.pathOf(t);var e=function(t,n,e){if(t===n||!t)return f(t===n,t,n);var r=e&&e.exact,o=s(t).split("/"),u=s(n).split("/");if(!(o.length>u.length||r&&o.length<u.length)){var a=0,i={},c=o.length;for(n="";a<c;a++){if(":"===o[a][0])i[o[a].slice(1)]=u[a]=l(u[a]);else if(o[a]!==u[a])return;n+=u[a]+"/"}return f(!1,t,n.slice(0,-1),i)}}(r.path,t.pathname,{exact:!r.parent});return e&&r.render({match:e,state:t})}},i.routerFactory=function(e){return{state:{pathname:e.location.pathname,previous:null},actions:{push:function(t){e.push(t)},replace:function(t){e.replace(t)},onChange:function(t){var e=t.location;return function(t){var n=t.pathname;return{pathname:e.pathname,previous:n}}}},sub:function(n){return e.listen(function(t){i.pathOf(n).onChange({location:t})})}}},i.Switch=function(t,o){return function(t,n){for(var e,r=0;!(e=o[r]&&o[r](t,n))&&r<o.length;)r++;return e}},i.withRouter=function(i,t){var n=t.moduleName,c=void 0===n?"router":n,e=t.unSubName,f=void 0===e?"unSubAll":e,r=t.factories,s=void 0===r?[]:r;return function(t,n,e,r){p(c);var o=s.reduce(function(t,n){var e=t.state,r=t.actions,o=t.subs,u=n.state,a=n.actions,i=n.sub;return{state:h({},e,u),actions:h({},r,a),subs:o.concat(i)}},{state:{},actions:{},subs:[]});t[c]=o.state,n[c]=o.actions;var u=i(t,n,e,r),a=o.subs.map(function(t){return t(u)});return u[f]=function(){return a.map(function(t){return t()})},u}},Object.defineProperty(i,"__esModule",{value:!0})});